# IVE 추천시스템 (M4 Final LLM)

## 📋 프로젝트 개요

IVE 추천시스템은 사용자의 광고 상호작용 이력을 기반으로 개인화된 광고 추천을 제공하는 콘텐츠 기반 추천 시스템입니다.

## 🚀 주요 기능

### 1. 콘텐츠 기반 추천
- **코사인 유사도** 기반 Top-K 추천
- **사용자 프로필**과 **광고 피처** 매칭
- **60개 피처**를 활용한 정교한 추천

### 2. 상호작용 분석
- **실제 상호작용 데이터** 기반 분석
- **상호작용 타입** 구분:
  - `클릭+전환`: `click_key` 또는 `click_key_rwd`가 있는 경우
  - `클릭`: `click_key_info`만 있는 경우
- **리워드 포인트** 정확한 계산

### 3. 사용자 인터페이스
- **Streamlit 기반** 웹 인터페이스
- **사용자 선택**: 드롭다운 또는 랜덤 선택
- **실시간 추천**: 즉시 결과 확인
- **상세 분석**: 추천 결과 및 상호작용 이력 표시

### 4. 타입/카테고리 가중치 시스템
- **자동 가중치 적용**: 사용자 과거 상호작용과 일치하는 광고에 자동으로 추가 점수
- **고정 보너스 값**: 성능 최적화를 위해 고정된 보너스 값 사용
- **다단계 보너스**:
  - 타입+카테고리 모두 일치: +0.05 (100% 보너스)
  - 타입만 일치: +0.025 (50% 보너스)
  - 카테고리만 일치: +0.015 (30% 보너스)

## 📊 데이터 구조

### 상호작용 데이터 (`correct_interactions.csv`)
- **총 상호작용**: 1,477,341개
- **고유 사용자**: 583,386명
- **고유 광고**: 2,819개
- **상호작용 타입 분포**:
  - 클릭+전환: 771,091개 (52.2%)
  - 클릭: 706,250개 (47.8%)
- **리워드 통계**:
  - 리워드가 있는 상호작용: 42,675개
  - 총 리워드 포인트: 7,729,564

### 사용자 프로필 데이터 (`preprocessed/user_profile.csv`)
- **총 사용자**: 585,000명
- **피처 수**: 60개 (motivation, engagement, promo, brand, commerce)
- **상호작용 이력**: 카테고리별, 타입별 상호작용 수

### 광고 메타데이터 (`preprocessed/ads_profile.csv`)
- **총 광고**: 445,260개
- **광고 정보**: 타입, 카테고리, 이름, 리워드 가격
- **피처 벡터**: 60차원 피처 벡터

## 🛠️ 기술 스택

- **Python**: 3.8+
- **Streamlit**: 웹 인터페이스
- **Pandas**: 데이터 처리
- **NumPy**: 수치 계산
- **Scikit-learn**: 코사인 유사도 계산
- **Plotly**: 시각화

## 📁 프로젝트 구조

```
M4_final_LLM/
├── recommender/
│   ├── app_streamlit.py          # 메인 Streamlit 앱
│   ├── reco_batch.py            # 배치 추천 시스템
│   └── eval_reco.py             # 추천 성능 평가
├── preprocessed/
│   ├── user_profile.csv         # 사용자 프로필 데이터
│   ├── ads_profile.csv          # 광고 프로필 데이터
│   └── f_ads_rwd_info.csv       # 원본 상호작용 데이터
├── input/save/
│   ├── correct_interactions.csv        # 정제된 상호작용 데이터 (최신)
│   ├── correct_interactions_all.csv    # 모든 상호작용 포함 데이터
│   ├── lightweight_user_profiles.csv   # 경량화된 사용자 프로필
│   ├── lightweight_json_features.csv   # 경량화된 광고 피처
│   └── lightweight_ads_list.csv        # 경량화된 광고 목록
├── create_correct_interactions.py      # 상호작용 데이터 생성
├── fix_user_device_id_properly.py      # 사용자 ID 수정
└── README.md                           # 프로젝트 설명서
```

## 🚀 실행 방법

### 1. 환경 설정
```bash
pip install -r requirements.txt
```

### 2. Streamlit 앱 실행
```bash
streamlit run recommender/app_streamlit.py
```

### 3. 브라우저 접속
- **로컬**: http://localhost:8501
- **네트워크**: http://192.168.1.120:8501

## 📈 성능 지표

### 추천 정확도
- **코사인 유사도** 기반 매칭
- **타입/카테고리 일치 보너스** 시스템 (자동 적용)
- **Top-K 추천** (기본값: 20개)
- **실시간 추천** (평균 1-2초)
- **성능 최적화** (고정 가중치 사용)

### 데이터 품질
- **상호작용 데이터**: 1,477,341개 (정제됨)
- **사용자 프로필**: 583,386개
- **광고 메타데이터**: 445,260개

## 🔧 주요 수정 사항

### 1. 상호작용 데이터 정제
- **원본 데이터**: `f_ads_rwd_info.csv` + `preprocessed_ads_list.csv`
- **상호작용 타입**: `click_key`, `click_key_rwd`, `click_key_info` 기반 분류
- **사용자 ID**: `dvc_idx` 우선 사용, 없으면 `user_ip` 사용

### 2. 데이터 일관성 개선
- **총 상호작용 수**와 **테이블 표시 수** 일치
- **리워드 계산** 정확성 향상
- **상호작용 타입** 올바른 구분

### 3. 타입/카테고리 가중치 시스템
- **자동 가중치 적용**: 사용자 과거 상호작용과 일치하는 광고에 자동으로 추가 점수
- **고정 보너스 값**: 성능 최적화를 위해 고정된 보너스 값 사용 (0.05)
- **다단계 보너스**: 타입+카테고리, 타입만, 카테고리만 일치에 따른 차등 보너스

### 4. 성능 최적화
- **캐싱**: `@st.cache_data` 데코레이터 사용
- **메모리 효율성**: 필요한 컬럼만 로드
- **로딩 시간**: 최적화된 데이터 처리

## 📝 사용법

### 1. 환경 설정
```bash
# 의존성 설치
pip install -r requirements.txt

# 데이터 압축 해제 (필요시)
python extract_data.py

# Streamlit 앱 실행
streamlit run recommender/app_streamlit.py
```

### 2. 데이터 파일
- **압축 파일**: `correct_interactions.zip` (54MB)
- **압축 해제**: 앱 실행 시 자동으로 해제됩니다
- **원본 파일**: `input/save/correct_interactions.csv` (184MB)

### 3. 사용자 선택
- **드롭다운**: 사용자 ID 직접 선택
- **랜덤 선택**: 랜덤 사용자 자동 선택

### 4. 추천 결과 확인
- **Top-K 추천**: 추천된 광고 목록
- **최종점수**: 콘텐츠 유사도 + 타입/카테고리 보너스
- **광고 정보**: 타입, 카테고리, 이름 등
- **자동 가중치**: 과거 상호작용과 일치하는 광고에 자동 보너스 적용

### 5. 상호작용 분석
- **사용자 정보**: 총 상호작용, 고유 광고 수, 총 리워드 금액
- **상호작용 이력**: 실제 상호작용한 광고 목록
- **상호작용 타입**: 클릭+전환 vs 클릭 구분

## 🎯 향후 개선 계획

1. **하이브리드 추천**: 콘텐츠 기반 + 협업 필터링
2. **실시간 학습**: 사용자 피드백 기반 모델 업데이트
3. **A/B 테스트**: 추천 알고리즘 성능 비교
4. **개인화 강화**: 더 세밀한 사용자 프로필링

## 📞 문의

프로젝트 관련 문의사항이 있으시면 이슈를 등록해주세요.

---

**IVE 추천시스템** - 개인화된 광고 추천을 위한 콘텐츠 기반 추천 시스템
