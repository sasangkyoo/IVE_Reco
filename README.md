# IVE 추천시스템 (M4 Final LLM)

## 📋 프로젝트 개요

IVE 추천시스템은 사용자의 광고 상호작용 이력을 기반으로 개인화된 광고 추천을 제공하는 콘텐츠 기반 추천 시스템입니다. 실제 광고 플랫폼 데이터(1,477,341개 상호작용)를 기반으로 현실적인 사용자 행동 패턴을 반영한 추천 시스템을 제공합니다.

### 🎯 핵심 특징
- **실제 데이터 기반**: 1,477,341개 실제 상호작용 데이터 분석
- **실시간 추천**: 1-2초 내 개인화된 광고 추천
- **자동 로딩**: 복잡한 설정 없이 즉시 사용 가능
- **확장성**: 5,000개 광고 중에서 최적의 추천

## 🚀 주요 기능

### 1. 콘텐츠 기반 추천
- **코사인 유사도** 기반 Top-K 추천
- **사용자 프로필**과 **광고 피처** 매칭
- **60개 피처**를 활용한 정교한 추천
- **5,000개 광고** 중에서 개인화된 추천

### 2. 실제 상호작용 분석
- **실제 상호작용 데이터** 기반 분석 (1,477,341개 상호작용)
- **실제 디바이스 ID** 사용 (예: '31380637', '53455653')
- **상호작용 타입** 구분:
  - `클릭+전환`: 5,077개 (50.0%)
  - `클릭`: 5,077개 (50.0%)
- **리워드 포인트** 정확한 계산

### 3. 사용자 인터페이스
- **Streamlit 기반** 웹 인터페이스
- **자동 데이터 로딩**: 실제 샘플 데이터 자동 사용
- **사용자 선택**: 드롭다운 또는 랜덤 선택 (실제 디바이스 ID)
- **실시간 추천**: 즉시 결과 확인
- **상세 분석**: 추천 결과 및 상호작용 이력 표시

### 4. 광고 필터링 시스템
- **날짜 기반 필터링**: 최근 2년 내 시작된 광고만 추천
- **재참여 타입 필터링**: 
  - `NONE`: 재참여 불가 (사용자가 이미 상호작용한 광고 제외)
  - `ADS_CODE_DAILY_UPDATE`: 매일 재참여 가능
  - `REJOINABLE`: 계속 재참여 가능
- **광고 유효성 검증**: 시작일/종료일 기반 활성 광고만 추천
- **필터링 효과**: 445,260개 → 420,831개 (94.51% 통과, 24,429개 제거)

### 5. 최종점수 계산 시스템
- **가중치 기반 통합**: 콘텐츠점수 + 추가점수 + 가치점수의 가중합
- **최종점수 공식**: `0.5 × 콘텐츠점수 + 0.4 × 추가점수 + 0.1 × 가치점수`
- **추가점수 (보너스)**: 사용자 선호도 기반 타입/카테고리 매칭 보너스
- **가치점수**: 리워드 민감도, 가격 민감도, 수익성, 랭킹 점수 통합

## 📊 데이터 구조

### 원본 실제 데이터
- **총 상호작용**: 1,477,341개 (원본)
- **고유 사용자**: 583,386명 (원본)
- **고유 광고**: 2,819개 (원본)

### 광고 타입 및 카테고리
- **타입**: 설치형, 실행형, 참여형, 클릭형, 페북, 트위터, 인스타, 노출형, 퀘스트, 유튜브, 네이버, CPS(물건구매)
- **카테고리**: 앱(간편적립), 구독(간편적립), 간편미션-퀘즈(간편적립), 경험하기(게임적립), 멀티보상(게임적립), 금융(참여적립), 무료참여(참여적립), 유료참여(참여적립), 쇼핑-상품별카테고리(쇼핑적립), 제휴몰(쇼핑적립), 간편미션(간편적립)
- **사용자별 상호작용 분포**:
  - 평균: 2.5개, 중간값: 1개, 표준편차: 5.6개
  - 최대: 2,659개, 최소: 1개
- **상호작용 타입 분포**:
  - 클릭+전환: 771,091개 (52.2%)
  - 클릭: 706,250개 (47.8%)

### 샘플 데이터 (현재 사용 중)
- **총 상호작용**: 1,265개 (샘플)
- **사용자**: 377명 (샘플)
- **광고**: 445,260개 (확장된 샘플) - 우선 사용
- **사용자별 상호작용 분포**:
  - 평균: 2.53개, 중간값: 2.0개, 표준편차: 1.5개
  - 최대: 9개, 최소: 1개
- **사용자 분포** (실제 데이터 기반):
  - **실제 디바이스 ID 사용** (예: '31380637', '53455653')
  - 92.0% 사용자가 2개 이상 상호작용
- **상호작용 타입 분포**:
  - 클릭+전환: 918개 (72.6%)
  - 클릭: 347개 (27.4%)

### 광고 메타데이터
- **총 광고**: 445,260개 (확장된 샘플) - 우선 사용
- **광고 정보**: 타입, 카테고리, 이름, 리워드 가격
- **피처 벡터**: 60차원 피처 벡터
- **광고 분포** (균등 분포):
  - 모든 광고가 1-50개 상호작용
  - 실제 광고 패턴 기반 확장

## 📈 성능 평가

### 전문적인 추천 시스템 평가 결과 (203,796명 사용자)
- **Coverage**: 1.19% (추천된 광고의 다양성)
- **Bias Ratio (Macro)**: 34.44 (카테고리별 편향도 평균)
- **Bias Ratio (Max)**: 162.42 (최대 편향도)
- **카테고리 매핑 적용**: 실제 카테고리 이름으로 정확한 편향도 분석

### K별 성능 메트릭 (10명 사용자 평가)
**K=5 (상위 5개 추천):**
- **Precision@5**: 20.00% (정확도)
- **Recall@5**: 50.00% (재현율)
- **F1@5**: 28.57% (F1 점수)
- **nDCG@5**: 61.31% (정규화된 할인 누적 이득)
- **HitRate@5**: 100.00% (히트율)
- **Coverage@5**: 1.06% (커버리지)
- **Bias@5**: 0.0000 (편향도)

**K=10 (상위 10개 추천):**
- **Precision@10**: 10.00% (정확도)
- **Recall@10**: 50.00% (재현율)
- **F1@10**: 16.67% (F1 점수)
- **nDCG@10**: 61.31% (정규화된 할인 누적 이득)
- **HitRate@10**: 100.00% (히트율)
- **Coverage@10**: 2.02% (커버리지)
- **Bias@10**: 0.0000 (편향도)

**K=20 (상위 20개 추천):**
- **Precision@20**: 5.00% (정확도)
- **Recall@20**: 44.44% (재현율)
- **F1@20**: 8.96% (F1 점수)
- **nDCG@20**: 56.52% (정규화된 할인 누적 이득)
- **HitRate@20**: 100.00% (히트율)
- **Coverage@20**: 3.80% (커버리지)
- **Bias@20**: 0.0000 (편향도)

### 상위 편향된 카테고리
1. **카테고리 5** (경험하기-게임적립-cpa): 162.42배 편향
2. **카테고리 2** (경험하기-게임적립/앱-간편적립): 74.95배 편향
3. **카테고리 0** (카테고리 선택안함): 57.08배 편향
4. **카테고리 13** (간편미션-간편적립): 49.81배 편향
5. **카테고리 6** (멀티보상-게임적립): 28.57배 편향

### 평가 결과 변화 분석
**이전 평가 결과 (v4.3 - 소규모 테스트):**
- **사용자 수**: 10명 | **추천 수**: 5개 | **처리 시간**: 약 30초
- **HitRate@5**: 85.71% | **Precision@5**: 28.57% | **Recall@5**: 85.71%
- **nDCG@5**: 85.08% | **Coverage**: 0.005%
- **Bias Ratio (Max)**: 54.00 | **Bias Ratio (Macro)**: 21.19

**현재 평가 결과 (대규모 실제 데이터):**
- **사용자 수**: 203,796명 | **추천 수**: 20개
- **HitRate@10**: 4.48% | **HitRate@20**: 5.10%
- **Precision@10**: 1.71% | **Precision@20**: 0.97%
- **Recall@10**: 2.11% | **Recall@20**: 2.35%
- **nDCG@10**: 5.79% | **nDCG@20**: 6.03%
- **Coverage**: 1.19%
- **Bias Ratio (Max)**: 162.42 | **Bias Ratio (Macro)**: 34.44

**변화 원인 및 결과:**
- **데이터 규모**: 소규모 테스트(10명) → 대규모 실제 데이터(203,796명)
- **카테고리 매핑**: 숫자 코드 → 실제 카테고리 이름으로 정확한 분석
- **성능 변화**: 소규모에서는 높은 성능, 대규모에서는 현실적인 성능
- **편향도 변화**: 실제 데이터에서 더 심각한 편향 패턴 발견

### 샘플 데이터 품질 지표
- **상호작용 밀도**: 0.066% (377명 사용자 × 5,091개 광고 대비)
- **사용자 활성도**: 92.0% (2개 이상 상호작용한 사용자 비율)
- **광고 인기도**: 1.3% (2개 이상 상호작용받은 광고 비율)

### 광고 타입 분포
- **참여형**: 4,861개 (95.5%) - 주요 광고 타입
- **설치형**: 119개 (2.3%)
- **CPS(물건구매)**: 30개 (0.6%)
- **실행형**: 53개 (1.0%)
- **기타**: 28개 (0.6%)

### 광고 카테고리 분포
- **간편미션-퀘즈**: 4,765개 (93.6%) - 주요 카테고리
- **앱(간편적립)**: 135개 (2.7%)
- **경험하기(게임적립)**: 45개 (0.9%)
- **구독(간편적립)**: 27개 (0.5%)
- **기타**: 119개 (2.3%)

### 상호작용 패턴
- **클릭+전환**: 918개 (72.6%) - 높은 전환율
- **클릭**: 347개 (27.4%) - 기본 클릭
- **평균 사용자당 상호작용**: 2.53개 (현실적인 수준)

## 🛠️ 기술 스택

- **Python**: 3.8+
- **Streamlit**: 웹 인터페이스
- **Pandas**: 데이터 처리
- **NumPy**: 수치 계산
- **Scikit-learn**: 코사인 유사도 계산
- **Plotly**: 시각화
- **광고 필터링 모듈**: 날짜 및 재참여 타입 기반 필터링

## 📁 프로젝트 구조

```
IVE_Reco/
├── 📄 README.md                           # 프로젝트 설명서
├── 📋 requirements.txt                    # Python 의존성
├── 🚀 STREAMLIT_DEPLOYMENT.md             # 배포 가이드
├── 📦 ads_profile_expanded_sample.zip     # 광고 데이터 (445,260개)
├── 👥 user_profile_sample.zip             # 사용자 데이터 (377명)
├── 🔗 correct_interactions_sample.zip     # 상호작용 데이터
├── 🖼️ icon/                               # Streamlit 아이콘
│   └── 1-794df7f8.ico
└── 📁 recommender/                        # 추천 시스템 코드
    ├── app_streamlit.py                   # Streamlit 웹 앱
    ├── reco_batch.py                      # 배치 추천 시스템
    ├── eval_reco.py                       # 평가 시스템
    ├── ads_filter.py                      # 광고 필터링 모듈
    └── README.md                          # 추천 시스템 설명서
```

## 🚀 실행 방법

### 1. 환경 설정
```bash
pip install streamlit pandas numpy scikit-learn plotly
```

### 2. Streamlit 앱 실행
```bash
streamlit run recommender/app_streamlit.py
```

### 3. 브라우저 접속
- **로컬**: http://localhost:8501
- **네트워크**: http://192.168.1.120:8501

### 4. 자동 데이터 로딩
- **실제 샘플 데이터** 자동 로딩
- **실제 디바이스 ID** 사용
- **445,260개 광고** 중에서 개인화된 추천

## 📈 성능 지표

### 추천 정확도
- **코사인 유사도** 기반 매칭
- **타입/카테고리 일치 보너스** 시스템 (자동 적용)
- **Top-K 추천** (기본값: 20개)
- **실시간 추천** (평균 1-2초)
- **성능 최적화** (고정 가중치 사용)

### 데이터 품질
- **실제 샘플 데이터**: 1,265개 상호작용 (377명 사용자, 445,260개 광고)
- **실제 디바이스 ID** 사용
- **원본 데이터 기반**: 1,477,341개 실제 상호작용 데이터 분석
- **자동 데이터 로딩**: 복잡한 설정 없이 즉시 사용 가능

## 🔧 주요 수정 사항

### 1. 광고 필터링 시스템 구현 (NEW!)
- **날짜 기반 필터링**: 최근 2년 내 시작된 광고만 추천 (24,429개 제거)
- **재참여 타입 필터링**: NONE, ADS_CODE_DAILY_UPDATE, REJOINABLE 타입별 처리
- **광고 유효성 검증**: 시작일/종료일 기반 활성 광고만 추천
- **자동 필터링**: Streamlit 앱 및 배치 추천 시스템에 자동 적용

### 2. 실제 데이터 기반 구현
- **실제 상호작용 데이터** 사용: 1,477,341개 원본 데이터 분석
- **실제 디바이스 ID** 사용: 가상 ID 대신 실제 ID 표시
- **균등 분포** 적용: 모든 사용자/광고가 1-50개 상호작용
- **원본 데이터 분석**: 실제 광고 플랫폼 데이터 기반

### 3. 자동 데이터 로딩 시스템
- **우선순위 기반** 데이터 선택: 확장된 샘플 → 기본 샘플 → 원본 데이터
- **ZIP 압축** 파일 자동 해제 및 로딩
- **복잡한 설정 없이** 즉시 사용 가능

### 4. 확장된 광고 데이터
- **445,260개 광고**: 실제 광고 패턴 기반 대규모 확장
- **다양한 추천 옵션**: 더 풍부한 추천 결과
- **실제 광고 패턴** 기반 확장

### 5. 최종점수 계산 시스템
- **가중치 기반 통합**: 콘텐츠점수 + 추가점수 + 가치점수의 가중합
- **최종점수 공식**: `0.5 × 콘텐츠점수 + 0.4 × 추가점수 + 0.1 × 가치점수`
- **추가점수 (보너스)**: 사용자 선호도 기반 타입/카테고리 매칭 보너스 (최대 1.0)
- **가치점수**: 리워드 민감도, 가격 민감도, 수익성, 랭킹 점수 통합

### 6. 성능 최적화
- **캐싱**: `@st.cache_data` 데코레이터 사용
- **메모리 효율성**: 필요한 컬럼만 로드
- **로딩 시간**: 최적화된 데이터 처리
- **조용한 로딩**: 불필요한 메시지 제거

## 📝 사용법

### 1. 환경 설정
```bash
# 의존성 설치
pip install streamlit pandas numpy scikit-learn plotly

# Streamlit 앱 실행
streamlit run recommender/app_streamlit.py
```

### 2. 자동 데이터 로딩
- **실제 샘플 데이터** 자동 로딩
- **ZIP 압축 파일** 자동 해제
- **복잡한 설정 없이** 즉시 사용 가능

### 3. 사용자 선택
- **드롭다운**: 실제 디바이스 ID 직접 선택 (377명 중)
- **랜덤 선택**: 랜덤 사용자 자동 선택

### 4. 추천 결과 확인
- **Top-K 추천**: 445,260개 광고 중 추천된 광고 목록
- **최종점수**: `0.5 × 콘텐츠점수 + 0.3 × 추가점수 + 0.2 × 가치점수`
- **상세 분석**: 콘텐츠점수, 가치점수, 추가점수 개별 표시
- **광고 정보**: 타입, 카테고리, 이름 등
- **사용자 선호도 기반**: 과거 상호작용 패턴에 따른 보너스 적용

### 5. 상호작용 분석
- **사용자 정보**: 총 상호작용, 고유 광고 수, 총 리워드 금액
- **상호작용 이력**: 실제 상호작용한 광고 목록
- **상호작용 타입**: 클릭+전환 vs 클릭 구분
- **실제 데이터**: 실제 디바이스 ID와 상호작용 패턴 사용

## 🎯 향후 개선 계획

1. **하이브리드 추천**: 콘텐츠 기반 + 협업 필터링
2. **실시간 학습**: 사용자 피드백 기반 모델 업데이트
3. **A/B 테스트**: 추천 알고리즘 성능 비교
4. **개인화 강화**: 더 세밀한 사용자 프로필링
5. **대용량 데이터 지원**: 원본 1,477,341개 상호작용 데이터 직접 사용
6. **실시간 추천**: 사용자 행동 기반 실시간 추천 업데이트

## 🌟 주요 특징

- **실제 데이터**: 실제 광고 플랫폼 데이터 기반 (1,477,341개 상호작용)
- **실제 디바이스 ID**: 가상 ID 대신 실제 디바이스 ID 사용
- **자동 로딩**: 복잡한 설정 없이 즉시 사용 가능
- **확장성**: 445,260개 광고로 풍부한 추천 옵션
- **성능 최적화**: 빠른 로딩과 실시간 추천

---

**IVE 추천시스템** - 개인화된 광고 추천을 위한 콘텐츠 기반 추천 시스템
